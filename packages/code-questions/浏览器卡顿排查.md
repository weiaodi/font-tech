浏览器卡顿是常见的性能问题，排查时需从**资源加载、渲染性能、JS执行、浏览器环境**等多维度分析。以下是系统化的排除步骤：

### 一、基础排查：确认卡顿场景

1. **复现条件**

   - 卡顿是否在特定页面/操作时出现？（如滚动、点击按钮、加载图片）
   - 是否与页面内容量相关？（如长列表、复杂表格）
   - 是否仅在移动端/特定浏览器出现？

2. **基础检查**
   - 清理浏览器缓存（`Ctrl+Shift+Delete`），排除缓存异常
   - 关闭其他标签页，减少资源竞争
   - 检查网络状态（卡顿是否伴随加载转圈？）

### 二、核心排查：使用开发者工具

#### 1. **Performance 面板（关键！）**

- **录制卡顿操作**：
  1. 打开 DevTools（`F12`）→ **Performance** 标签
  2. 点击红色录制按钮，复现卡顿操作，结束后停止录制
  3. 重点看 **火焰图** 和 **FPS 指标**：
     - **FPS 波动**：绿色竖线越高代表流畅（60fps为理想），若频繁低于30fps则卡顿
     - **长任务（红色块）**：JS 执行超过50ms会阻塞UI渲染，需优化
     - **Layout/Style Recalc**：频繁重排重绘（黄色/紫色块）会导致卡顿

#### 2. **Network 面板**

- 检查资源加载是否异常：
  - **大文件加载慢**：如未压缩的图片、超大JS包（目标：单个资源 < 100KB）
  - **请求阻塞**：查看 `Waterfall` 图，是否有资源加载顺序不合理（如CSS阻塞渲染）
  - **重复请求**：相同资源多次加载（检查缓存策略 `Cache-Control`）

#### 3. **Memory 面板**

- 检测内存泄漏（可能导致渐进式卡顿）：
  1. 刷新页面后记录初始内存
  2. 复现操作后多次GC（点击垃圾桶图标），观察内存是否持续增长
  3. 若内存持续上升，可能存在闭包/事件监听未销毁等泄漏问题

### 三、常见卡顿原因及解决方案

#### 1. **JS 执行阻塞**

- **现象**：操作时页面完全无响应，Performance 中出现长红色任务
- **优化**：
  - 将耗时操作（如大数据计算）拆分为微任务（`requestIdleCallback`）
  - 避免在 `scroll/mouseMove` 等高频事件中执行复杂逻辑
  - 使用 Web Worker 分离计算密集型任务

#### 2. **重排重绘过多**

- **现象**：滚动时页面闪烁，Performance 中 `Style`/`Layout` 耗时高
- **优化**：
  - 用 `will-change: transform` 提前告知浏览器动画变化
  - 合并DOM操作，使用 `DocumentFragment` 批量更新
  - 避免频繁修改元素尺寸（如用 `classList` 替代直接改样式）

#### 3. **资源加载问题**

- **图片优化**：
  - 用 `WebP` 格式压缩图片（体积减少30%+）
  - 为长列表添加 **懒加载**（`loading="lazy"` 或 Intersection Observer）
- **JS/CSS 优化**：
  - 代码分割（`import()` 动态加载非关键模块）
  - 移除未使用的CSS（用 PurgeCSS 等工具）
  - 优先加载关键资源：给CSS添加 `rel="stylesheet"`，JS添加 `defer/async`

#### 4. **渲染层合并问题**

- **现象**：复杂动画卡顿，GPU占用高
- **优化**：
  - 对频繁动画的元素开启硬件加速：`transform: translateZ(0)`
  - 减少层数量（DevTools → **Layers** 面板查看）
  - 避免使用 `position: fixed` 在滚动容器中

### 四、移动端专项优化

1. **触摸事件优化**

   - 用 `touchstart/touchend` 替代 `click`（点击延迟300ms）
   - 禁止默认触摸行为：`event.preventDefault()`（如缩放、滚动）

2. **硬件加速**

   - 对滚动容器添加 `-webkit-overflow-scrolling: touch`
   - 避免在 `touchmove` 中触发重排（用 `requestAnimationFrame` 延迟处理）

3. **低端设备适配**
   - 检测设备性能（`window.performance.getEntries()`），动态降级效果
   - 简化动画：用CSS过渡替代JS动画，减少3D变换

### 五、辅助排查工具

- **Lighthouse**：DevTools 中运行性能审计，获取优化建议（目标分数 > 80）
- **PageSpeed Insights**：输入URL，分析移动端/PC端性能瓶颈
- **CSS Triggers**：Chrome 扩展，实时显示重排重绘触发源
- **Frame Rate**：iOS 开发者工具，监控移动端FPS变化

### 六、总结排查流程

1. **复现卡顿** → 2. **Performance 录制分析** → 3. **定位瓶颈（JS/渲染/资源）** → 4. **针对性优化** → 5. **对比测试（优化前后录制性能）**

通过以上步骤，可系统性定位卡顿根源，多数场景下优化后能显著提升流畅度。
