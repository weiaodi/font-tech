<!doctype html>
<html>
  <head>
    <title>高清SVG渲染到Canvas（增强文字清晰度）</title>
    <script type="module">
      import { Canvg } from 'https://cdn.skypack.dev/canvg@^4.0.0';

      window.onload = () => {
        const canvas = document.getElementById('canvas');
        const renderBtn = document.getElementById('renderBtn');
        const ctx = canvas.getContext('2d');

        // 基础尺寸设置
        const baseSize = 400;

        // 高清渲染核心配置
        function setupHighResCanvas() {
          const dpr = window.devicePixelRatio || 1;
          // 显示尺寸
          canvas.style.width = `${baseSize}px`;
          canvas.style.height = `${baseSize}px`;
          // 实际像素尺寸（关键：乘以设备像素比）
          canvas.width = baseSize * dpr;
          canvas.height = baseSize * dpr;
          // 应用缩放
          ctx.scale(dpr, dpr);
          // 优化文字渲染
          ctx.imageSmoothingQuality = 'high';
        }

        // SVG内容 - 优化了字体设置
        const svg = `
<svg width="${baseSize}" height="${baseSize}" xmlns="http://www.w3.org/2000/svg">
    <rect width="${baseSize}" height="${baseSize}" fill="#f0f0f0"/>
    <circle cx="${baseSize / 2}" cy="${baseSize / 3}" r="80" fill="#2196f3"/>
    <rect x="${baseSize / 2 - 50}" y="${baseSize * 0.65}" width="100" height="60" rx="5" fill="#4caf50"/>
    <line x1="50" y1="50" x2="${baseSize - 50}" y2="${baseSize - 50}" stroke="#f44336" stroke-width="2"/>
    <path d="M50,${baseSize - 50} Q${baseSize / 2},${baseSize - 120} ${baseSize - 50},${baseSize - 50}" 
          fill="none" stroke="#ff9800" stroke-width="2"/>
</svg>`;

        // 初始化高清Canvas
        setupHighResCanvas();

        // 渲染函数 - 优化渲染参数
        renderBtn.addEventListener('click', async () => {
          ctx.clearRect(0, 0, baseSize, baseSize);

          // 优化渲染选项，特别是文字处理
          await Canvg.fromString(ctx, svg, {
            scale: 1,
            ignoreDimensions: false,
          }).render();
        });
        a;

        // 窗口大小变化时重新设置
        window.addEventListener('resize', setupHighResCanvas);
      };
    </script>
  </head>
  <body>
    <button id="renderBtn" style="padding: 8px 16px; font-size: 16px; margin: 10px">
      渲染高清SVG（优化文字清晰度）
    </button>
    <div>
      <canvas id="canvas" style="border: 1px solid #ccc"></canvas>
    </div>
  </body>
</html>
